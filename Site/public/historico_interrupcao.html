<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="./css/historico.css" />
		<script src="./js/historico.js"></script>
		<title>Hitorico - Interrupções</title>
	</head>
	<body>

		<div id="menuLateral">
			<img id="logo" src="./assets/imgs/logoData-White.png" alt="">
			<div id="menuLateralSecoes">
				<a href="./dashGeral.html">
					<img src="./assets/imgs/iconeDash.png" alt="">
					<span>Dashboard</span>
				</a>
				<a href="">
					<img src="./assets/imgs/iconePerfil.png" alt="">
					<span>Perfil</span>
				</a>
				<a href="">
					<img src="./assets/imgs/iconeNotificacao.png" alt="">
					<span>Notificações</span>                
				</a>
				<a href="./unidadeConsumidora.html">
					<img src="./assets/imgs/iconeEmpresas.png" alt="">
					<span>Unidades Consumidoras</span>
				</a>
				<a href="./historico_interrupcao.html">
					<img src="./assets/imgs/historico_icon.png" alt="">
					<span>historico de interrupções</span>
				</a>
			</div>
			<a id="botaoSair" onclick="sair()">
				<img src="./assets/imgs/iconeSair.png" alt="">
				Sair
			</a>
		</div>

		<main class="main">
			<section class="header" role="banner">
				<img id="botaoMenu" onclick="abrirMenu()" src="./assets/imgs/iconeSeta.png" alt="">
            	<div id="secaoUsuario">
                	<img src="./assets/imgs/iconeUsuario.png" alt="">
                	<div id="dadosUsuario">
                    	<span>Usuario</span>
                    	<span>Cargo</span>
                </div>
			</section>

			<h1>Interrupções</h1>

			<form class="filter" role="search" onsubmit="return false;">
				<select aria-label="Campo de filtro">
					<option value="">Unidade Consumidora</option>
					<option value="">Data Início</option>
					<option value="">Data Fim</option>
					<option value="">Duração</option>
					<option value="">Motivo</option>
				</select>
				<input
					type="text"
					placeholder="Buscar..."
					aria-label="Buscar por campo selecionado"
				/>
				<button type="submit" aria-label="Pesquisar"><img class="lupinha" src="./assets/imgs/lupa.png" alt=""></button>
				
			</form>

			<table>
				<thead>
					<tr>
						<th>Id Distribuidora</th>
						<th>Distribuidora</th>
						<th>Unidade Consumidora</th>
						<th>Data Início</th>
						<th>Data Fim</th>
						<th>Duração (min)</th>
						<th>Motivo</th>
					</tr>
				</thead>
				<tbody id="table_historico">
					
				</tbody>
			</table>
		</main>
	</body>
</html>
<script src="/env.js"></script>
<script>
	function sair() {
		sessionStorage.clear(); // Limpa toda a sessão do usuário
		window.location.href = `http://${window.APP_HOST}:8080/login.html`;; // Redireciona para a tela de login
	}



  	fetch(`/historico/buscarHistorico/${sessionStorage.FK_DISTRIBUIDORA}`, { 
		method: 'GET',
		cache: 'no-store'
	})
	.then(function (response) {
		if (response.ok) {
			response.json().then(function (resposta) {
				console.log(`Dados recebidos de historico no front: ${JSON.stringify(resposta)}`);
				var interrupcoes = resposta

				for (let interrupcao of resposta) {
				table_historico.innerHTML += `
					<tr>
						<td>${interrupcao.idDistribuidora}</td>
						<td>${interrupcao.distribuidora}</td>
						<td>${interrupcao.unidade_consumidora}</td>
						<td>${new Date(interrupcao.data_inicio).toLocaleString("pt-BR", { timeZone: "America/Sao_Paulo" })}</td>
						<td>${new Date(interrupcao.data_fim).toLocaleString("pt-BR", { timeZone: "America/Sao_Paulo" })}</td>
						<td>${interrupcao.duracao}</td>
						<td>${interrupcao.motivo}</td>
					</tr>
				`;
				}
			});
		} else {
			console.error('Nenhum dado encontrado ou erro na API');
		}
    })
	.catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ historico: ${error.message}`);
    });



</script>


