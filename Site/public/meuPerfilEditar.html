<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/estiloDashEspecifica.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <Script src="./js/sessao.js"></Script>
    <script src="./js/meuPerfil.js"></script>
    <!-- <link rel="stylesheet" href="./css/unidadeConsumidora.css"> -->
    <!-- <link rel="stylesheet" href="./css/meuPerfilExcluir.css"> -->
    <link rel="stylesheet" href="./css/meuPerfilEditar.css">
    <title>Editar Perfil</title>
</head>

<body>
    <div id="menuLateral">
        <img id="logo" src="./assets/imgs/logoData-White.png" alt="">
        <div id="menuLateralSecoes">
            <a href="">
                <img src="./assets/imgs/iconePerfil.png" alt="">
                <span>Perfil</span>
            </a>
            <a href="./">
                <img src="./assets/imgs/iconeNotificacao.png" alt="">
                <span>Notificações</span>
            </a>
            <a href="./listaDiretores.html">
                <img src="./assets/imgs/usuarios.png" alt="">
                <span>Usuarios Regionais</span>
            </a>
        
            <a href="./grupos.html">
                <img src="./assets/imgs/iconeEmpresas.png" alt="">
                <span>Grupos</span>
            </a>
        </div>
        <a id="botaoSair" onclick="sair()">
            <img src="./assets/imgs/iconeSair.png" alt="">
            Sair
        </a>
    </div>
    <div id="containerConteudo">
        <section id="cabecalho">
            <img style="transform: scaleX(-1);" id="botaoMenu" onclick="abrirMenu()" src="./assets/imgs/iconeSeta.png"
                alt="">
            <div id="secaoUsuario">
                <img src="./assets/imgs/iconeUsuario.png" alt="">
                <div id="dadosUsuario">
                    <span>Usuario</span>
                    <span>Cargo</span>
                </div>
            </div>
        </section>
        <h1>

        </h1>
        <!-- Aqui começa os codigo -->
        <section id="metricas">
            <section id="cartoes">
                <div class="profile-container">
                    <h1>Meu Perfil</h1>
                    <form action="#" method="post" class="profile-form">
                        <div class="form-group">
                            <label for="name">Nome:</label>
                            <input type="text" id="id_nome" name="name" placeholder="Nome" required minlength="3">
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="id_email" name="email" placeholder="email@gmail.com" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Senha:</label>
                            <input type="password" id="password" name="password" placeholder="********" disabled>
                        </div>
                        <div class="form-group">
                            <label for="phone">Telefone:</label>
                            <input type="tel" id="id_telefone" name="phone" placeholder="11999999999" pattern="^\d{10,11,12,13}$"
                                required title="O número deve conter 10 ou 11 dígitos. Exemplo: (11)99999-9999">
                        </div>
                        <div class="button-group">
                            <button onclick="window.location.href='./meuPerfilExcluir.html'" type="button" class="btn-edit">CANCELAR</button>
                            <button type="button" onclick="alterarDados()" class="btn-delete">SALVAR</button>
                        </div>
                    </form>
                </div>
            </section>
        </section>
    </div>
</body>

</html>
<script src="./js/sidebar.js"></script>

<script>

   function alterarDados() {
        var nome = document.getElementById("id_nome").value.trim();
        var email = document.getElementById("id_email").value.trim();
        var telefone = document.getElementById("id_telefone").value.trim();

        if (nome === "" || email === "" || telefone === "") {
            Swal.fire({
                icon: "warning",
                title: "Oops...",
                text: `Todos os campos devem ser preenchidos`,
            });
            return false;
        } else if (nome.length > 20) {
            Swal.fire({
                icon: "warning",
                title: "Oops...",
                text: "O nome não pode ultrapassar 20 caracteres!",
            });
            return false;
        } else if (telefone.length < 10 || telefone.length > 15) {
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "O telefone deve ter entre 10 e 15 dígitos",
                color: "#f01f1a",
                customClass: {
                    confirmButton: "custom-button",
                },
            });
            return false;
        } else if (!email.includes("@") || !email.includes(".com")) {
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "O email deve conter '@' e '.com'",
                color: "#f01f1a",
                customClass: {
                    confirmButton: "custom-button", 
                },
            });
            return false;
        }

        atualizarDiretor();

        console.log("Dados validados:", nome, email, telefone);
    }



    function atualizarDiretor(){
        fetch(`/usuarios/atualizarDadosDiretor/${sessionStorage.ID_USUARIO}`, {
            method: "PUT",
            headers: {
            "Content-Type": "application/json",
            },
            body: JSON.stringify({
                nome: document.getElementById("id_nome").value ,
                email: document.getElementById("id_email").value ,
                telefone: document.getElementById("id_telefone").value ,
            }),
        })
        .then(function (resposta) {
            console.log("ESTOU NO THEN DO deletarDiretor()!");
            console.log(resposta)
            if (resposta.ok) {
                Swal.fire({
                    title: "Sucesso!",
                    text: "Usuário atualizado!",
                    icon: "success",
                    showConfirmButton: false,
                    color: "#1ed619",
                    heightAuto: false,
                });
                console.log(`Diretor de id = ${sessionStorage.ID_USUARIO} 
                atualizado com sucesso`);
                window.location.href = "meuPerfilExcluir.html"
            } else {
                console.log("Houve um erro ao tentar atualizar os dados do diretor!");
                
                resposta.text().then((texto) => {
                    console.error(texto);
                });
            }
        })
        .catch(function (erro) {
            console.log(erro);
        });
    }


    function pegarDadosDiretor(){
        fetch(`/usuarios/pegarDadosDiretor/${sessionStorage.ID_USUARIO}`, {
            method: "GET",
        })
        .then(function (resposta) {
            console.log("ESTOU NO THEN DO pegarDadosDiretor()!");
            console.log(resposta)
            if (resposta.ok) {

            resposta.json().then((json) => {
                console.log(json);
                console.log(JSON.stringify(json));
                document.getElementById("id_nome").value = json.diretor;
                document.getElementById("id_email").value = json.email;
                document.getElementById("id_telefone").value  = json.telefone;
            });
            } else {
                console.log("Houve um erro ao tentar pegar os dados do diretor!");
                
                resposta.text().then((texto) => {
                    console.error(texto);
                });
            }
        })
        .catch(function (erro) {
            console.log(erro);
        });
    }

</script>